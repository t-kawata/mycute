basePath: /
definitions:
  AbsorbCubeParam:
    properties:
      chat_model_id:
        example: 1
        type: integer
      chunk_overlap:
        example: 16
        type: integer
      chunk_size:
        example: 512
        type: integer
      content:
        example: Knowledge base for Go development
        type: string
      cube_id:
        example: 1
        type: integer
      memory_group:
        example: legal_expert
        type: string
      stream:
        example: false
        type: boolean
    type: object
  AbsorbCubeRes:
    properties:
      data:
        $ref: '#/definitions/AbsorbCubeResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  AbsorbCubeResData:
    properties:
      absorb_limit:
        type: integer
      input_tokens:
        type: integer
      output_tokens:
        type: integer
    type: object
  AuthUsrRes:
    properties:
      data:
        $ref: '#/definitions/AuthUsrResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  AuthUsrResData:
    properties:
      token:
        example: ???????????????
        type: string
    type: object
  CheckKeyHashParam:
    properties:
      key:
        example: ????????????????
        type: string
    type: object
  CheckKeyHashRes:
    properties:
      data:
        $ref: '#/definitions/CheckKeyHashResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  CheckKeyHashResData:
    properties:
      result:
        example: true
        type: boolean
    type: object
  ContributorRes:
    properties:
      contributor_name:
        type: string
      input_tokens:
        type: integer
      model_name:
        type: string
      output_tokens:
        type: integer
    type: object
  CreateChatModelParam:
    properties:
      api_key:
        example: sk-proj-...
        type: string
      base_url:
        example: https://api.openai.com/v1
        type: string
      max_tokens:
        example: 4096
        type: integer
      model:
        example: gpt-4o
        type: string
      name:
        example: My GPT-4
        type: string
      provider:
        example: openai
        type: string
      temperature:
        example: 0.2
        type: number
    required:
    - api_key
    - model
    - name
    - provider
    type: object
  CreateChatModelRes:
    properties:
      data:
        $ref: '#/definitions/CreateChatModelResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  CreateChatModelResData:
    properties:
      id:
        type: integer
    type: object
  CreateCubeParam:
    properties:
      description:
        example: Knowledge base for Go development
        type: string
      embedding_api_key:
        example: sk-proj-...
        type: string
      embedding_base_url:
        example: https://api.openai.com/v1
        type: string
      embedding_dimension:
        example: 1536
        type: integer
      embedding_model:
        example: text-embedding-3-small
        type: string
      embedding_provider:
        example: openai
        type: string
      name:
        example: My Cube
        type: string
    type: object
  CreateCubeRes:
    properties:
      data:
        $ref: '#/definitions/CreateCubeResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  CreateCubeResData:
    properties:
      id:
        example: 1
        type: integer
      uuid:
        example: 550e8400-e29b-41d4-a716-446655440000
        type: string
    type: object
  CreateUsrParam:
    properties:
      bgn_at:
        example: 2023-01-01T00:00:00
        format: date-time
        type: string
      email:
        example: sample@example.com
        format: email
        type: string
      end_at:
        example: 2100-12-31T23:59:59
        format: date-time
        type: string
      name:
        example: User01
        type: string
      password:
        example: ta5!CAzQz8DjMydju?
        format: password
        type: string
      type:
        example: 1
        type: integer
    type: object
  CreateUsrRes:
    properties:
      data:
        $ref: '#/definitions/CreateUsrResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  CreateUsrResData:
    properties:
      id:
        type: integer
    type: object
  DehireUsrRes:
    properties:
      data:
        $ref: '#/definitions/DehireUsrResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  DehireUsrResData:
    type: object
  DeleteChatModelRes:
    properties:
      data:
        $ref: '#/definitions/DeleteChatModelResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  DeleteChatModelResData:
    type: object
  DeleteCubeRes:
    properties:
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  DeleteUsrRes:
    properties:
      data:
        $ref: '#/definitions/DeleteUsrResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  DeleteUsrResData:
    type: object
  EmptyObj:
    type: object
  Err:
    properties:
      code:
        example: 100000
        type: integer
      field:
        example: field_name
        type: string
      message:
        example: Some Error Message
        type: string
    type: object
  ErrRes:
    properties:
      data:
        $ref: '#/definitions/EmptyObj'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  GenKeyCubeRes:
    properties:
      data:
        $ref: '#/definitions/GenKeyCubeResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  GenKeyCubeResData:
    properties:
      key:
        type: string
    type: object
  GenerateKeyHashRes:
    properties:
      data:
        $ref: '#/definitions/GenerateKeyHashResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  GenerateKeyHashResData:
    properties:
      hash:
        example: ???????????
        type: string
    type: object
  GetChatModelRes:
    properties:
      data:
        $ref: '#/definitions/GetChatModelResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  GetChatModelResData:
    properties:
      base_url:
        type: string
      created_at:
        type: string
      id:
        type: integer
      max_tokens:
        type: integer
      model:
        type: string
      name:
        type: string
      provider:
        type: string
      temperature:
        type: number
      updated_at:
        type: string
    type: object
  GetCubeRes:
    properties:
      data:
        $ref: '#/definitions/GetCubeResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  GetCubeResData:
    properties:
      cube:
        $ref: '#/definitions/rtres.GetCubeResCube'
      lineage:
        items:
          $ref: '#/definitions/LineageRes'
        type: array
      memory_groups:
        items:
          $ref: '#/definitions/MemoryGroupStatsRes'
        type: array
    type: object
  GetUsrRes:
    properties:
      data:
        $ref: '#/definitions/GetUsrResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  GetUsrResData:
    properties:
      apx_id:
        example: 1
        type: integer
      bgn_at:
        example: 2023-01-01T00:00:00
        format: date-time
        type: string
      email:
        example: sample@example.com
        format: email
        type: string
      end_at:
        example: 2023-01-01T00:00:00
        format: date-time
        type: string
      id:
        example: 1
        type: integer
      name:
        example: User01
        type: string
      type:
        example: 1
        type: integer
      vdr_id:
        example: 1
        type: integer
    type: object
  HireUsrRes:
    properties:
      data:
        $ref: '#/definitions/HireUsrResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  HireUsrResData:
    type: object
  ImportCubeRes:
    properties:
      data:
        $ref: '#/definitions/ImportCubeResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  ImportCubeResData:
    properties:
      id:
        type: integer
      uuid:
        type: string
    type: object
  LineageRes:
    properties:
      exported_at:
        description: timestamp ms
        type: integer
      exported_at_jst:
        description: YYYY-MM-DDThh:mm:ss (JST)
        type: string
      generation:
        type: integer
      owner:
        type: string
      uuid:
        type: string
    type: object
  MemifyCubeParam:
    properties:
      chat_model_id:
        example: 1
        type: integer
      cube_id:
        example: 1
        type: integer
      epochs:
        example: 1
        type: integer
      memory_group:
        example: legal_expert
        type: string
      prioritize_unknowns:
        example: true
        type: boolean
      stream:
        example: false
        type: boolean
    type: object
  MemifyCubeRes:
    properties:
      data:
        $ref: '#/definitions/MemifyCubeResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  MemifyCubeResData:
    properties:
      input_tokens:
        example: 5000
        type: integer
      memify_limit:
        example: -1
        type: integer
      output_tokens:
        example: 2000
        type: integer
    type: object
  MemoryGroupStatsRes:
    properties:
      contributors:
        items:
          $ref: '#/definitions/ContributorRes'
        type: array
      memory_group:
        type: string
      stats:
        items:
          $ref: '#/definitions/ModelStatRes'
        type: array
    type: object
  ModelStatRes:
    properties:
      action_type:
        description: '"training" or "search"'
        type: string
      input_tokens:
        type: integer
      model_name:
        type: string
      output_tokens:
        type: integer
    type: object
  QueryCubeParam:
    properties:
      chat_model_id:
        example: 1
        type: integer
      chunk_topk:
        example: 3
        type: integer
      cube_id:
        example: 1
        type: integer
      entity_topk:
        example: 3
        type: integer
      memory_group:
        example: legal_expert
        type: string
      stream:
        example: false
        type: boolean
      summary_topk:
        example: 3
        type: integer
      text:
        example: 契約違反の場合の対処法は？
        type: string
      type:
        example: 1
        type: integer
    type: object
  QueryCubeRes:
    properties:
      data:
        $ref: '#/definitions/QueryCubeResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  QueryCubeResData:
    properties:
      answer:
        example: 契約違反の場合は...
        type: string
      chunks:
        example: 契約違反の場合は...
        type: string
      graph:
        items:
          type: string
        type: array
      input_tokens:
        example: 1500
        type: integer
      output_tokens:
        example: 500
        type: integer
      query_limit:
        example: -1
        type: integer
      summaries:
        example: 契約違反の場合は...
        type: string
    type: object
  ReKeyCubeParam:
    properties:
      cube_id:
        example: 1
        type: integer
      key:
        example: alknas38msd...
        type: string
    type: object
  ReKeyCubeRes:
    properties:
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  SearchChatModelsParam:
    properties:
      base_url:
        example: https://api.openai.com/v1
        type: string
      model:
        example: gpt-4o
        type: string
      name:
        example: My GPT-4
        type: string
      provider:
        example: openai
        type: string
    type: object
  SearchChatModelsRes:
    properties:
      data:
        items:
          $ref: '#/definitions/SearchChatModelsResData'
        type: array
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  SearchChatModelsResData:
    properties:
      base_url:
        type: string
      created_at:
        type: string
      id:
        type: integer
      max_tokens:
        type: integer
      model:
        type: string
      name:
        type: string
      provider:
        type: string
      temperature:
        type: number
      updated_at:
        type: string
    type: object
  SearchCubesParam:
    properties:
      description:
        example: Legal advisor
        type: string
      limit:
        example: 20
        type: integer
      name:
        example: Legal Bot
        type: string
      offset:
        example: 0
        type: integer
    type: object
  SearchCubesRes:
    properties:
      data:
        items:
          $ref: '#/definitions/SearchCubesResData'
        type: array
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  SearchCubesResData:
    properties:
      cube:
        $ref: '#/definitions/rtres.SearchCubesResCube'
      lineage:
        items:
          $ref: '#/definitions/LineageRes'
        type: array
      memory_groups:
        items:
          $ref: '#/definitions/MemoryGroupStatsRes'
        type: array
    type: object
  SearchUsrParam:
    properties:
      bgn_at:
        example: 2023-01-01T00:00:00
        format: date-time
        type: string
      email:
        example: sample@example.com
        format: email
        type: string
      end_at:
        example: 2100-12-31T23:59:59
        format: date-time
        type: string
      limit:
        example: 10
        type: integer
      name:
        example: User01
        type: string
      offset:
        example: 0
        type: integer
    type: object
  SearchUsrsRes:
    properties:
      data:
        items:
          $ref: '#/definitions/SearchUsrsResData'
        type: array
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  SearchUsrsResData:
    properties:
      apx_id:
        example: 1
        type: integer
      bgn_at:
        example: 2023-01-01T00:00:00
        format: date-time
        type: string
      email:
        example: sample@example.com
        format: email
        type: string
      end_at:
        example: 2023-01-01T00:00:00
        format: date-time
        type: string
      id:
        example: 1
        type: integer
      name:
        example: User01
        type: string
      type:
        example: 1
        type: integer
      vdr_id:
        example: 1
        type: integer
    type: object
  UpdateChatModelParam:
    properties:
      api_key:
        example: sk-proj-...
        type: string
      base_url:
        example: https://api.openai.com/v1
        type: string
      max_tokens:
        example: 4096
        type: integer
      model:
        example: gpt-4o
        type: string
      name:
        example: My GPT-4
        type: string
      provider:
        example: openai
        type: string
      temperature:
        example: 0.2
        type: number
    type: object
  UpdateChatModelRes:
    properties:
      data:
        $ref: '#/definitions/UpdateChatModelResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  UpdateChatModelResData:
    type: object
  UpdateUsrParam:
    properties:
      bgn_at:
        example: 2023-01-01T00:00:00
        format: date-time
        type: string
      email:
        example: sample@example.com
        format: email
        type: string
      end_at:
        example: 2100-12-31T23:59:59
        format: date-time
        type: string
      name:
        example: User01
        type: string
      password:
        example: ta5!CAzQz8DjMydju?
        format: password
        type: string
      type:
        example: 1
        type: integer
    type: object
  UpdateUsrRes:
    properties:
      data:
        $ref: '#/definitions/UpdateUsrResData'
      errors:
        items:
          $ref: '#/definitions/Err'
        type: array
    type: object
  UpdateUsrResData:
    type: object
  rtres.GetCubeResCube:
    properties:
      apx_id:
        example: 1
        type: integer
      created_at:
        example: 2025-01-01T00:00:00
        format: date-time
        type: string
      description:
        example: This is my cube
        type: string
      embedding_base_url:
        type: string
      embedding_dimension:
        type: integer
      embedding_model:
        type: string
      embedding_provider:
        type: string
      expire_at:
        example: 2025-01-01T00:00:00
        format: date-time
        type: string
      id:
        example: 1
        type: integer
      name:
        example: MyCube
        type: string
      permissions:
        example: '{}'
        type: string
      source_export_id:
        example: 1
        type: integer
      updated_at:
        example: 2025-01-01T00:00:00
        format: date-time
        type: string
      uuid:
        example: 550e8400-e29b-41d4-a716-446655440000
        type: string
      vdr_id:
        example: 1
        type: integer
    type: object
  rtres.SearchCubesResCube:
    properties:
      apx_id:
        example: 1
        type: integer
      created_at:
        example: 2025-01-01T00:00:00
        format: date-time
        type: string
      description:
        example: This is my cube
        type: string
      embedding_base_url:
        type: string
      embedding_dimension:
        type: integer
      embedding_model:
        type: string
      embedding_provider:
        type: string
      expire_at:
        example: 2025-01-01T00:00:00
        format: date-time
        type: string
      id:
        example: 1
        type: integer
      name:
        example: MyCube
        type: string
      permissions:
        example: '{}'
        type: string
      source_export_id:
        example: 1
        type: integer
      updated_at:
        example: 2025-01-01T00:00:00
        format: date-time
        type: string
      uuid:
        example: 550e8400-e29b-41d4-a716-446655440000
        type: string
      vdr_id:
        example: 1
        type: integer
    type: object
info:
  contact: {}
  description: '## API概要\nMYCUTE REST APIを定義する。\nURL最大長のリスクを避ける為、検索は query parameter
    ではなく body json を使用する。\nGin に SEARCH/QUERY method の実装がないため、検索を POST にて行う。'
  title: MYCUTE
paths:
  /v1/chat_models/:
    post:
      consumes:
      - application/json
      description: '- USR によってのみ使用できる'
      parameters:
      - description: token
        in: header
        name: Authorization
        required: true
        type: string
      - description: json
        in: body
        name: json
        required: true
        schema:
          $ref: '#/definitions/CreateChatModelParam'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/CreateChatModelRes'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ErrRes'
      summary: ChatModel作成
      tags:
      - v1 ChatModel
  /v1/chat_models/{chat_model_id}:
    delete:
      description: '- USR によってのみ使用できる'
      parameters:
      - description: token
        in: header
        name: Authorization
        required: true
        type: string
      - description: ChatModel ID
        in: path
        name: chat_model_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/DeleteChatModelRes'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ErrRes'
      summary: ChatModel削除
      tags:
      - v1 ChatModel
    get:
      description: '- USR によってのみ使用できる'
      parameters:
      - description: token
        in: header
        name: Authorization
        required: true
        type: string
      - description: ChatModel ID
        in: path
        name: chat_model_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/GetChatModelRes'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ErrRes'
      summary: ChatModel詳細取得
      tags:
      - v1 ChatModel
    patch:
      consumes:
      - application/json
      description: '- USR によってのみ使用できる'
      parameters:
      - description: token
        in: header
        name: Authorization
        required: true
        type: string
      - description: ChatModel ID
        in: path
        name: chat_model_id
        required: true
        type: integer
      - description: json
        in: body
        name: json
        required: true
        schema:
          $ref: '#/definitions/UpdateChatModelParam'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/UpdateChatModelRes'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ErrRes'
      summary: ChatModel更新
      tags:
      - v1 ChatModel
  /v1/chat_models/search:
    post:
      consumes:
      - application/json
      description: '- USR によってのみ使用できる'
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: Search Params
        in: body
        name: params
        required: true
        schema:
          $ref: '#/definitions/SearchChatModelsParam'
      produces:
      - application/json
      responses:
        "200":
          description: Success
          schema:
            $ref: '#/definitions/SearchChatModelsRes'
        "400":
          description: Validation Error
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ErrRes'
      summary: ChatModelを検索
      tags:
      - v1 ChatModel
  /v1/cubes/absorb:
    put:
      consumes:
      - application/json
      description: |-
        - USR によってのみ使用できる
        - Cube に知識を追加する
        - 実行には AbsorbLimit に残数が必要
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: json
        in: body
        name: json
        required: true
        schema:
          $ref: '#/definitions/AbsorbCubeParam'
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/AbsorbCubeRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ErrRes'
      summary: コンテンツを取り込む
      tags:
      - v1 Cube
  /v1/cubes/create:
    post:
      consumes:
      - application/json
      description: |-
        - USR によってのみ使用できる
        - 作成者は「神権限 (Limit = 0: 無制限)」を持つ
        - Cube は知識ベースとして機能し、Absorb/Memify/Search を通じて利用される
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: json
        in: body
        name: json
        required: true
        schema:
          $ref: '#/definitions/CreateCubeParam'
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/CreateCubeRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ErrRes'
      summary: 新しいCubeを作成する。
      tags:
      - v1 Cube
  /v1/cubes/delete:
    delete:
      description: |-
        - USR によってのみ使用できる
        - 指定したCubeと関連データを完全に削除する
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: Cube ID
        in: query
        name: cube_id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/DeleteCubeRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ErrRes'
      summary: Cubeを削除する (Delete)
      tags:
      - v1 Cube
  /v1/cubes/export:
    get:
      consumes:
      - application/json
      description: |-
        - USR によってのみ使用できる
        - Cube を .cube ファイルとしてダウンロードする
        - 実行には ExportLimit に残数が必要
        - 成功すると Zip ファイル (application/zip) が返却される
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: Cube ID
        in: query
        name: cube_id
        required: true
        type: integer
      responses:
        "200":
          description: cube_uuid.cube
          schema:
            type: file
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ErrRes'
      summary: Cube をエクスポートする。
      tags:
      - v1 Cube
  /v1/cubes/genkey:
    post:
      consumes:
      - multipart/form-data
      description: |-
        - USR によってのみ使用できる
        - Exportされた.cubeファイルをアップロードして鍵を発行
        - 発行される鍵には権限と有効期限が含まれる
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: .cube file
        in: formData
        name: file
        required: true
        type: file
      - description: CubePermission JSON
        in: formData
        name: permissions
        required: true
        type: string
      - description: 有効期限 (ISO8601)
        in: formData
        name: expire_at
        type: string
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/GenKeyCubeRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ErrRes'
      summary: 鍵を発行する
      tags:
      - v1 Cube
  /v1/cubes/get/{cube_id}:
    get:
      consumes:
      - application/json
      description: |-
        - USR によってのみ使用できる
        - Cube の基本情報、統計、系譜情報を取得する
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: Cube ID
        in: path
        name: cube_id
        required: true
        type: integer
      responses:
        "200":
          description: Success
          schema:
            $ref: '#/definitions/GetCubeRes'
        "400":
          description: Validation Error
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ErrRes'
      summary: Cubeの詳細情報を取得
      tags:
      - v1 Cube
  /v1/cubes/import:
    post:
      consumes:
      - multipart/form-data
      description: |-
        - USR によってのみ使用できる
        - .cubeファイルと鍵を使用してCubeをインポート
        - 鍵に含まれる権限と有効期限が適用される
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: .cube file
        in: formData
        name: file
        required: true
        type: file
      - description: インポートするCubeが要求する埋め込みモデル用API-KEY
        in: formData
        name: embedding_api_key
        required: true
        type: string
      - description: 鍵文字列
        in: formData
        name: key
        required: true
        type: string
      - description: 新しいCube名
        in: formData
        name: name
        required: true
        type: string
      - description: 説明
        in: formData
        name: description
        type: string
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/ImportCubeRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ErrRes'
      summary: Cubeをインポートする
      tags:
      - v1 Cube
  /v1/cubes/memify:
    put:
      consumes:
      - application/json
      description: |-
        - USR によってのみ使用できる
        - 指定したCubeの知識を強化・最適化する
        - memory_groupで対象分野を指定
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: json
        in: body
        name: json
        required: true
        schema:
          $ref: '#/definitions/MemifyCubeParam'
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/MemifyCubeRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ErrRes'
      summary: Cubeを自己強化する (Memify)
      tags:
      - v1 Cube
  /v1/cubes/query:
    post:
      description: |-
        - USR によってのみ使用できる
        - 指定したCubeの知識を利用してクエリに回答する
        - memory_groupで対象分野を指定
        ---
        ### クエリタイプ一覧
        | ID | Type | Description |
        |---|---|---|
        | 1 | QUERY_TYPE_GET_GRAPH | 知識グラフ自体を取得 |
        | 2 | QUERY_TYPE_GET_CHUNKS | ベクトル検索によりチャンクを取得 |
        | 3 | QUERY_TYPE_GET_PRE_MADE_SUMMARIES | 事前に作成された要約リストを取得 |
        | 4 | QUERY_TYPE_GET_GRAPH_AND_CHUNKS | 知識グラフとベクトル検索によるチャンクを取得 |
        | 5 | QUERY_TYPE_GET_GRAPH_AND_PRE_MADE_SUMMARIES | 知識グラフと事前に作成された要約リストを取得 |
        | 6 | QUERY_TYPE_GET_GRAPH_AND_CHUNKS_AND_PRE_MADE_SUMMARIES | 知識グラフとベクトル検索によるチャンクと事前に作成された要約リストを取得 |
        | 7 | QUERY_TYPE_GET_GRAPH_EXPLANATION_EN | 知識グラフを英語で構造文変換して取得 |
        | 8 | QUERY_TYPE_GET_GRAPH_EXPLANATION_JA | 知識グラフを日本語で構造文変換して取得 |
        | 9 | QUERY_TYPE_GET_GRAPH_SUMMARY_EN | 知識グラフを英語で要約文変換して取得 |
        | 10 | QUERY_TYPE_GET_GRAPH_SUMMARY_JA | 知識グラフを日本語で要約文変換して取得 |
        | 11 | QUERY_TYPE_GET_GRAPH_SUMMARY_TO_ANSWER_EN | 知識グラフを、クエリにダイレクトに答えられる形式の英語要約文で取得 |
        | 12 | QUERY_TYPE_GET_GRAPH_SUMMARY_TO_ANSWER_JA | 知識グラフを、クエリにダイレクトに答えられる形式の日本語要約文で取得 |
        | 13 | QUERY_TYPE_ANSWER_BY_PRE_MADE_SUMMARIES_AND_GRAPH_SUMMARY_EN | 事前に作成された要約リストと、知識グラフ要約を用いて質問に英語で回答 |
        | 14 | QUERY_TYPE_ANSWER_BY_PRE_MADE_SUMMARIES_AND_GRAPH_SUMMARY_JA | 事前に作成された要約リストと、知識グラフ要約を用いて質問に日本語で回答 |
        | 15 | QUERY_TYPE_ANSWER_BY_CHUNKS_AND_GRAPH_SUMMARY_EN | ベクトル検索によるチャンクと知識グラフ要約を用いて質問に英語で回答 |
        | 16 | QUERY_TYPE_ANSWER_BY_CHUNKS_AND_GRAPH_SUMMARY_JA | ベクトル検索によるチャンクと知識グラフ要約を用いて質問に日本語で回答 |
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: json
        in: body
        name: json
        required: true
        schema:
          $ref: '#/definitions/QueryCubeParam'
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/QueryCubeRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ErrRes'
      summary: Cubeにクエリを実行する (Query)
      tags:
      - v1 Cube
  /v1/cubes/rekey:
    post:
      consumes:
      - application/json
      description: |-
        - USR によってのみ使用できる
        - 新しい鍵を使用して権限と有効期限を更新
        - ReKey対象のCubeはImportされたものである必要がある
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: json
        in: body
        name: json
        required: true
        schema:
          $ref: '#/definitions/ReKeyCubeParam'
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/ReKeyCubeRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ErrRes'
      summary: Cubeの権限を更新する (ReKey)
      tags:
      - v1 Cube
  /v1/cubes/search:
    post:
      description: |-
        - USR によってのみ使用できる
        - 条件に一致するCubeの詳細情報を一覧取得する
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: Search Params
        in: body
        name: params
        required: true
        schema:
          $ref: '#/definitions/SearchCubesParam'
      responses:
        "200":
          description: Success
          schema:
            $ref: '#/definitions/SearchCubesRes'
        "400":
          description: Validation Error
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ErrRes'
      summary: Cubeを検索
      tags:
      - v1 Cube
  /v1/keys/check:
    post:
      consumes:
      - application/json
      parameters:
      - description: json
        in: body
        name: json
        required: true
        schema:
          $ref: '#/definitions/CheckKeyHashParam'
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/CheckKeyHashRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
      summary: 鍵の一致を確認する。
      tags:
      - v1 Key
  /v1/keys/generate:
    get:
      consumes:
      - application/json
      parameters:
      - description: key
        in: query
        name: key
        required: true
        type: string
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/GenerateKeyHashRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
      summary: 鍵を生成する。
      tags:
      - v1 Key
  /v1/usrs/:
    post:
      consumes:
      - application/json
      description: |-
        - Key で取得した token では Apx のみを作成できる
        - Apx で取得した token では Vdr のみを作成できる
        - Vdr で取得した token では Usr のみを作成できる
        - Usr は Usr を作れない
        ### パラメータについて
        - type: 1: 法人, 2: 個人 (VDR作成時は無視される)
        - VDR作成時以外にVDR用項目を送信するとエラーとなる
        - 法人作成時以外に法人用項目を送信するとエラーとなる
        ### name について
        - type=2 (個人) の場合、姓名の間にスペース（半角・全角問わず）が必須
        - 全角スペースは半角スペースに変換され、連続するスペースは1つにまとめられる
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: json
        in: body
        name: json
        required: true
        schema:
          $ref: '#/definitions/CreateUsrParam'
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/CreateUsrRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
      summary: ユーザを作成する。
      tags:
      - v1 User
  /v1/usrs/{usr_id}:
    delete:
      consumes:
      - application/json
      description: |-
        - Keyは安全の為、削除権限を持たない
        - Apxは配下のVdrのみを削除できる
        - Vdrは、配下の全てのユーザを削除できる
        - Usrは使用できない
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: ユーザID
        in: path
        name: usr_id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/DeleteUsrRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
      summary: ユーザを削除する。
      tags:
      - v1 User
    get:
      consumes:
      - application/json
      description: |-
        - Keyは全てのユーザを取得できる
        - Apxは配下のVdr以下の全てのユーザを取得できる
        - Vdrは、配下の全てのユーザを取得できる
        - Usr は使用できない
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: ユーザID
        in: path
        name: usr_id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/GetUsrRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
      summary: ユーザ情報を1件取得する。
      tags:
      - v1 User
    patch:
      consumes:
      - application/json
      description: |-
        - Keyは安全の為、更新権限を持たない
        - Apxは配下のVdr以下の全てのユーザを更新できる
        - Vdrは、配下の全てのユーザを更新できる
        - Usrは使用できない
        ### パラメータについて
        - type: 1: 法人, 2: 個人 (更新時は変更不可の場合がある)
        - VDR以外にVDR用項目を送信するとエラーとなる
        - 法人以外に法人用項目を送信するとエラーとなる
        ### name について
        - type=2 (個人) の場合、姓名の間にスペース（半角・全角問わず）が必須
        - 全角スペースは半角スペースに変換され、連続するスペースは1つにまとめられる
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: ユーザID
        in: path
        name: usr_id
        required: true
        type: integer
      - description: json
        in: body
        name: json
        required: true
        schema:
          $ref: '#/definitions/UpdateUsrParam'
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/UpdateUsrRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
      summary: ユーザ情報を更新する。
      tags:
      - v1 User
  /v1/usrs/{usr_id}/hire:
    delete:
      consumes:
      - application/json
      description: |-
        - Vdr によってのみ使用できる
        - スタッフは Vdr として振る舞うため、同様に使用できる
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: ユーザID
        in: path
        name: usr_id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/DehireUsrRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
      summary: ユーザからベンダーのスタッフとしての権限を剥奪する。
      tags:
      - v1 User
    patch:
      consumes:
      - application/json
      description: |-
        - Vdr によってのみ使用できる
        - スタッフは Vdr として振る舞うため、同様に使用できる
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: ユーザID
        in: path
        name: usr_id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/HireUsrRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
      summary: ユーザにベンダーのスタッフとしての権限を与える。
      tags:
      - v1 User
  /v1/usrs/auth/{apx_id}/{vdr_id}:
    get:
      consumes:
      - application/json
      description: |-
        ### 総則
        - X-Key での認証時は、X-Key を入れ、apx_id=0、vdr_id=0、email & password はダミーを入力
        - APX として認証する場合、apx_id=0、vdr_id=0、email & password は当該APXのもの
        - VDR として認証する場合、apx_id=所属ApxID、vdr_id=0、email & password は当該VDRのもの
        - USR として認証する場合、apx_id=所属ApxID、vdr_id=所属VdrID、email & password は当該USRのもの
        - expire は hour で指定すること
        ### スタッフについて
        - USRは、VDR の権限により、VDRのスタッフになることができる
        - スタッフとしての立場を与えられた USRは、その後、スタッフとしての token のみを取得できる
        - スタッフ token を使用した場合、システム内で常に VDR として振る舞うことになる
        - その場合、全ての操作は当該 VDR が行ったものと同一の結果となる
        - 行った操作が、どのスタッフによるものか記録したい場合は、token payload 内の usr_id で記録できる
        - システム内部においては、ju.StaffID がそれにあたる
        ### 注意
        - スタッフであるかどうかの確認は、tokenの取得のタイミングで1度だけ行われる
        - 取得した token が、スタッフであるか否かを示す唯一の証明書である
        - 当該 USR が真にスタッフであるかを問わず、システムは token によってのみスタッフか否かを判断する
        - つまり、スタッフ token を取得後、VDR により当該 USR がスタッフ権限を剥奪されたとしても、当該 token の expire までは、そのスタッフ token は有効である
      parameters:
      - description: key
        example: ??????????
        in: header
        name: X-Key
        type: string
      - description: apx_id
        in: path
        name: apx_id
        required: true
        type: integer
      - description: vdr_id
        in: path
        name: vdr_id
        required: true
        type: integer
      - description: email
        in: query
        name: email
        required: true
        type: string
      - description: password
        in: query
        name: password
        required: true
        type: string
      - description: expire
        example: 24
        in: query
        name: expire
        required: true
        type: number
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/AuthUsrRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
      summary: 認証を行い、tokenを返す。ロールや権限も一緒に返す。
      tags:
      - v1 User
  /v1/usrs/search:
    post:
      consumes:
      - application/json
      description: |-
        - Keyは全てのユーザを検索できる
        - Apxは配下のVdr以下の全てのユーザを検索できる
        - Vdrは、配下の全てのユーザを検索できる
        - Usr は使用できない
      parameters:
      - description: token
        example: Bearer ??????????
        in: header
        name: Authorization
        required: true
        type: string
      - description: json
        in: body
        name: json
        required: true
        schema:
          $ref: '#/definitions/SearchUsrParam'
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/SearchUsrsRes'
            - properties:
                errors:
                  items:
                    type: integer
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/ErrRes'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrRes'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/ErrRes'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/ErrRes'
      summary: ユーザを検索する。
      tags:
      - v1 User
schemes:
- http
swagger: "2.0"
